<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Player with Ads</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-4xl">
        <div class="relative bg-black rounded-lg overflow-hidden shadow-2xl">
            <!-- Main Video Thumbnail (Visible initially) -->
            <video
                id="thumbnailVideo"
                class="w-full aspect-video"
                playsinline
            >
                <source src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>

            <!-- Ad Video Player (Hidden initially) -->
            <video
                id="adVideo"
                class="w-full aspect-video hidden"
                playsinline
            >
                <source src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>

            <!-- Main Video Player (Hidden initially) -->
            <video
                id="mainVideo"
                class="w-full aspect-video hidden"
                playsinline
            >
                <source src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>

            <!-- Main Video Controls -->
            <div id="mainVideoControls" class="hidden">
                <!-- Video Description (Top Left) -->
                <div id="videoInfo" class="absolute top-4 left-4 max-w-sm bg-gradient-to-r from-black/80 to-transparent p-3 pr-6 rounded-lg opacity-0 transition-opacity duration-300">
                    <h2 id="videoTitle" class="text-white text-base font-bold mb-1">Big Buck Bunny</h2>
                    <p id="videoDescription" class="text-gray-300 text-xs leading-relaxed">
                        A large and lovable rabbit deals with three tiny bullies, led by a flying squirrel, who are determined to squelch his happiness.
                    </p>
                </div>

                <!-- Settings Button (Top Right) -->
                <div class="absolute top-4 right-4 opacity-0 transition-opacity duration-300" id="settingsContainer">
                    <button id="settingsBtn" class="bg-black/60 hover:bg-black/80 text-white rounded-full p-2 transition-all">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
                        </svg>
                    </button>

                    <!-- Settings Menu Dropdown -->
                    <div id="settingsMenu" class="hidden absolute top-12 right-0 bg-black/95 text-white rounded-lg shadow-2xl overflow-hidden w-56">
                        <!-- Speed Settings -->
                        <div class="border-b border-gray-700">
                            <button id="speedMenuBtn" class="w-full px-4 py-3 hover:bg-white/10 transition-colors flex items-center justify-between">
                                <span class="font-semibold">Speed</span>
                                <div class="flex items-center">
                                    <span id="currentSpeed" class="text-sm text-gray-300 mr-2">1x</span>
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
                                    </svg>
                                </div>
                            </button>
                            <div id="speedSubmenu" class="hidden bg-black/98">
                                <button class="speed-option w-full px-6 py-2 hover:bg-white/10 transition-colors text-left text-sm" data-speed="0.5">0.5x</button>
                                <button class="speed-option w-full px-6 py-2 hover:bg-white/10 transition-colors text-left text-sm" data-speed="0.75">0.75x</button>
                                <button class="speed-option w-full px-6 py-2 hover:bg-white/10 transition-colors text-left text-sm bg-white/20" data-speed="1">Normal (1x)</button>
                                <button class="speed-option w-full px-6 py-2 hover:bg-white/10 transition-colors text-left text-sm" data-speed="1.25">1.25x</button>
                                <button class="speed-option w-full px-6 py-2 hover:bg-white/10 transition-colors text-left text-sm" data-speed="1.5">1.5x</button>
                                <button class="speed-option w-full px-6 py-2 hover:bg-white/10 transition-colors text-left text-sm" data-speed="2">2x</button>
                            </div>
                        </div>

                        <!-- Quality/Resolution Settings -->
                        <div>
                            <button id="qualityMenuBtn" class="w-full px-4 py-3 hover:bg-white/10 transition-colors flex items-center justify-between">
                                <span class="font-semibold">Quality</span>
                                <div class="flex items-center">
                                    <span id="currentQuality" class="text-sm text-gray-300 mr-2">Auto</span>
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
                                    </svg>
                                </div>
                            </button>
                            <div id="qualitySubmenu" class="hidden bg-black/98">
                                <button class="quality-option w-full px-6 py-2 hover:bg-white/10 transition-colors text-left text-sm bg-white/20" data-quality="auto">Auto</button>
                                <button class="quality-option w-full px-6 py-2 hover:bg-white/10 transition-colors text-left text-sm" data-quality="1080p">1080p</button>
                                <button class="quality-option w-full px-6 py-2 hover:bg-white/10 transition-colors text-left text-sm" data-quality="720p">720p</button>
                                <button class="quality-option w-full px-6 py-2 hover:bg-white/10 transition-colors text-left text-sm" data-quality="480p">480p</button>
                                <button class="quality-option w-full px-6 py-2 hover:bg-white/10 transition-colors text-left text-sm" data-quality="360p">360p</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Loading Spinner (Center) -->
                <div id="loadingSpinner" class="absolute inset-0 flex items-center justify-center pointer-events-none hidden">
                    <svg class="animate-spin h-10 w-10 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </div>

                <!-- Play/Pause Button Overlay (Center) -->
                <div id="centerPlayPause" class="absolute inset-0 flex items-center justify-center pointer-events-none">
                    <div class="flex items-center space-x-4">
                        <!-- Skip Backward 10s Button -->
                        <button
                            id="skipBackwardBtn"
                            class="bg-black/60 hover:bg-black/80 text-white rounded-full p-3 transform hover:scale-110 transition-all shadow-2xl pointer-events-auto opacity-0"
                        >
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M11.99 5V1l-5 5 5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6h-2c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z" opacity="0.4"/>
                                <text x="9" y="16" font-size="8" fill="currentColor" font-weight="bold" text-anchor="middle">10</text>
                            </svg>
                        </button>

                        <!-- Play/Pause Button -->
                        <button
                            id="centerPlayButton"
                            class="bg-black/60 hover:bg-black/80 text-white rounded-full p-4 transform hover:scale-110 transition-all shadow-2xl pointer-events-auto opacity-0"
                        >
                            <svg id="centerPlayIcon" class="w-10 h-10" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                            <svg id="centerPauseIcon" class="w-10 h-10 hidden" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
                            </svg>
                        </button>

                        <!-- Skip Forward 10s Button -->
                        <button
                            id="skipForwardBtn"
                            class="bg-black/60 hover:bg-black/80 text-white rounded-full p-3 transform hover:scale-110 transition-all shadow-2xl pointer-events-auto opacity-0"
                        >
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 5V1l5 5-5 5V7c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6h2c0 4.42-3.58 8-8 8s-8-3.58-8-8 3.58-8 8-8z" opacity="0.4"/>
                                <text x="15" y="16" font-size="8" fill="currentColor" font-weight="bold" text-anchor="middle">10</text>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Bottom Control Bar -->
                <div id="bottomControls" class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/90 via-black/70 to-transparent p-4 opacity-0 transition-opacity duration-300">
                    <!-- Progress Bar -->
                    <div class="mb-3">
                        <div class="relative w-full h-1 bg-gray-600 rounded-full cursor-pointer group" id="progressBarContainer">
                            <div id="progressBar" class="absolute h-full bg-red-600 rounded-full" style="width: 0%"></div>
                            <div id="progressHandle" class="absolute w-3 h-3 bg-white rounded-full -top-1 -ml-1.5 opacity-0 group-hover:opacity-100 transition-opacity" style="left: 0%"></div>
                        </div>
                    </div>

                    <!-- Controls -->
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <!-- Time Display -->
                            <div class="text-white text-sm font-medium">
                                <span id="currentTime">0:00</span> / <span id="duration">0:00</span>
                            </div>
                        </div>

                        <div class="flex items-center space-x-3">
                            <!-- Volume Control -->
                            <div class="flex items-center space-x-2">
                                <button id="volumeBtn" class="text-white hover:text-red-500 transition-colors">
                                    <svg id="volumeIcon" class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>
                                    </svg>
                                    <svg id="muteIcon" class="w-7 h-7 hidden" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>
                                    </svg>
                                </button>
                                <input
                                    type="range"
                                    id="volumeSlider"
                                    min="0"
                                    max="100"
                                    value="100"
                                    class="w-20 h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer"
                                    style="accent-color: #ef4444;"
                                >
                            </div>

                            <!-- Fullscreen Button -->
                            <button id="fullscreenBtn" class="text-white hover:text-red-500 transition-colors">
                                <svg id="fullscreenIcon" class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
                                </svg>
                                <svg id="exitFullscreenIcon" class="w-7 h-7 hidden" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ad Overlay -->
            <div id="adOverlay" class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-black/50 pointer-events-none">
                <!-- Loading Spinner for Ad -->
                <div id="adLoadingSpinner" class="absolute inset-0 flex items-center justify-center pointer-events-none hidden">
                    <svg class="animate-spin h-10 w-10 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </div>

                <!-- Ad Counter -->
                <div class="absolute top-4 left-4 bg-yellow-500 text-black px-3 py-1 rounded-full text-sm font-bold">
                    Ad
                </div>

                <!-- Ad Time Remaining -->
                <div id="adTimeRemaining" class="absolute top-4 right-4 bg-black/70 text-white px-3 py-1 rounded-full text-sm">
                    <span id="adTimer">--</span>s
                </div>

                <!-- Skip Button (Hidden initially) -->
                <button
                    id="skipButton"
                    class="absolute bottom-8 right-8 bg-white text-black px-6 py-3 rounded-lg font-bold hover:bg-gray-200 transition-all transform hover:scale-105 opacity-0 pointer-events-none"
                >
                    Skip Ad →
                </button>

                <!-- Countdown Before Skip -->
                <div id="skipCountdown" class="absolute bottom-8 right-8 bg-black/70 text-white px-6 py-3 rounded-lg font-bold">
                    Skip in <span id="skipTimer">5</span>s
                </div>
            </div>

            <!-- Play Button Overlay -->
            <div id="playOverlay" class="absolute inset-0 flex items-center justify-center bg-black/40">
                <button
                    id="playButton"
                    class="bg-red-600 hover:bg-red-700 text-white rounded-full p-4 transform hover:scale-110 transition-all shadow-2xl"
                >
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Info Text -->
        <div class="mt-6 text-center text-gray-400 text-sm">
            <p>Video akan memutar iklan terlebih dahulu. Klik tombol Skip setelah 5 detik atau tunggu hingga iklan selesai.</p>
        </div>
    </div>

    <script>
        // Thumbnail Elements
        const thumbnailVideo = document.getElementById('thumbnailVideo');

        // Ad Elements
        const adVideo = document.getElementById('adVideo');
        const adOverlay = document.getElementById('adOverlay');
        const skipButton = document.getElementById('skipButton');
        const skipCountdown = document.getElementById('skipCountdown');
        const skipTimer = document.getElementById('skipTimer');
        const adTimer = document.getElementById('adTimer');
        const playOverlay = document.getElementById('playOverlay');
        const playButton = document.getElementById('playButton');

        // Main Video Elements
        const mainVideo = document.getElementById('mainVideo');
        const mainVideoControls = document.getElementById('mainVideoControls');
        const videoInfo = document.getElementById('videoInfo');
        const centerPlayButton = document.getElementById('centerPlayButton');
        const centerPlayIcon = document.getElementById('centerPlayIcon');
        const centerPauseIcon = document.getElementById('centerPauseIcon');
        const skipBackwardBtn = document.getElementById('skipBackwardBtn');
        const skipForwardBtn = document.getElementById('skipForwardBtn');
        const bottomControls = document.getElementById('bottomControls');
        const progressBarContainer = document.getElementById('progressBarContainer');
        const progressBar = document.getElementById('progressBar');
        const progressHandle = document.getElementById('progressHandle');
        const currentTimeEl = document.getElementById('currentTime');
        const durationEl = document.getElementById('duration');
        const volumeBtn = document.getElementById('volumeBtn');
        const volumeIcon = document.getElementById('volumeIcon');
        const muteIcon = document.getElementById('muteIcon');
        const volumeSlider = document.getElementById('volumeSlider');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const fullscreenIcon = document.getElementById('fullscreenIcon');
        const exitFullscreenIcon = document.getElementById('exitFullscreenIcon');
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsMenu = document.getElementById('settingsMenu');
        const settingsContainer = document.getElementById('settingsContainer');
        const speedMenuBtn = document.getElementById('speedMenuBtn');
        const speedSubmenu = document.getElementById('speedSubmenu');
        const qualityMenuBtn = document.getElementById('qualityMenuBtn');
        const qualitySubmenu = document.getElementById('qualitySubmenu');
        const currentSpeed = document.getElementById('currentSpeed');
        const currentQuality = document.getElementById('currentQuality');
        const speedOptions = document.querySelectorAll('.speed-option');
        const qualityOptions = document.querySelectorAll('.quality-option');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const adLoadingSpinner = document.getElementById('adLoadingSpinner');

        let adDuration = 0;
        let hideControlsTimeout;
        let isUserInteracting = false;
        let isSettingsOpen = false;

        // ============ AD VIDEO FUNCTIONS ============

        // Play button click handler
        playButton.addEventListener('click', () => {
            // Hide thumbnail and show ad video
            thumbnailVideo.classList.add('hidden');
            adVideo.classList.remove('hidden');
            adVideo.play();
            playOverlay.classList.add('hidden');
        });

        // When ad video metadata is loaded
        adVideo.addEventListener('loadedmetadata', () => {
            adDuration = Math.floor(adVideo.duration);
        });

        // Update ad timer and skip countdown
        adVideo.addEventListener('timeupdate', () => {
            const currentTime = Math.floor(adVideo.currentTime);
            const remainingTime = Math.floor(adVideo.duration - adVideo.currentTime);

            // Update ad time remaining
            adTimer.textContent = remainingTime;

            // Show skip button after 5 seconds
            if (currentTime >= 5) {
                skipCountdown.classList.add('hidden');
                skipButton.classList.remove('opacity-0', 'pointer-events-none');
                skipButton.classList.add('opacity-100', 'pointer-events-auto');
            } else {
                // Update countdown
                skipTimer.textContent = 5 - currentTime;
            }
        });

        // When ad starts playing
        adVideo.addEventListener('play', () => {
            skipCountdownValue = 5;
            skipCountdown.classList.remove('hidden');
            skipButton.classList.add('opacity-0', 'pointer-events-none');
            skipButton.classList.remove('opacity-100', 'pointer-events-auto');
        });

        // Skip button click handler
        skipButton.addEventListener('click', () => {
            skipToMainVideo();
        });

        // When ad ends, automatically play main video
        adVideo.addEventListener('ended', () => {
            skipToMainVideo();
        });

        // Ad video loading events
        adVideo.addEventListener('waiting', () => {
            adLoadingSpinner.classList.remove('hidden');
        });

        adVideo.addEventListener('canplay', () => {
            adLoadingSpinner.classList.add('hidden');
        });

        adVideo.addEventListener('playing', () => {
            adLoadingSpinner.classList.add('hidden');
        });

        adVideo.addEventListener('seeking', () => {
            adLoadingSpinner.classList.remove('hidden');
        });

        adVideo.addEventListener('seeked', () => {
            adLoadingSpinner.classList.add('hidden');
        });

        // Function to switch to main video
        function skipToMainVideo() {
            // Stop and reset ad video
            adVideo.pause();
            adVideo.currentTime = 0;

            // Hide ad elements
            adVideo.classList.add('hidden');
            adOverlay.classList.add('hidden');

            // Show and play main video
            mainVideo.classList.remove('hidden');
            mainVideoControls.classList.remove('hidden');
            mainVideo.play();
        }

        // ============ MAIN VIDEO CONTROLS ============

        // Format time helper
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }

        // Toggle play/pause
        function togglePlayPause() {
            if (mainVideo.paused) {
                mainVideo.play();
            } else {
                mainVideo.pause();
            }
        }

        // Update play/pause icons
        function updatePlayPauseIcons(isPlaying) {
            if (isPlaying) {
                centerPlayIcon.classList.add('hidden');
                centerPauseIcon.classList.remove('hidden');
            } else {
                centerPlayIcon.classList.remove('hidden');
                centerPauseIcon.classList.add('hidden');
            }
        }

        // Show/hide controls
        function showControls() {
            bottomControls.style.opacity = '1';
            centerPlayButton.style.opacity = '1';
            skipBackwardBtn.style.opacity = '1';
            skipForwardBtn.style.opacity = '1';
            videoInfo.style.opacity = '1';
            settingsContainer.style.opacity = '1';
            clearTimeout(hideControlsTimeout);

            if (!mainVideo.paused && !isUserInteracting && !isSettingsOpen) {
                hideControlsTimeout = setTimeout(() => {
                    bottomControls.style.opacity = '0';
                    centerPlayButton.style.opacity = '0';
                    skipBackwardBtn.style.opacity = '0';
                    skipForwardBtn.style.opacity = '0';
                    videoInfo.style.opacity = '0';
                    settingsContainer.style.opacity = '0';
                }, 3000);
            }
        }

        // Center play/pause button
        centerPlayButton.addEventListener('click', (e) => {
            e.stopPropagation();
            togglePlayPause();
        });

        // Skip backward 10 seconds
        skipBackwardBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            mainVideo.currentTime = Math.max(0, mainVideo.currentTime - 10);
            showControls();
        });

        // Skip forward 10 seconds
        skipForwardBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            mainVideo.currentTime = Math.min(mainVideo.duration, mainVideo.currentTime + 10);
            showControls();
        });

        // Click anywhere on video to play/pause
        mainVideo.addEventListener('click', togglePlayPause);

        // Update UI when playing
        mainVideo.addEventListener('play', () => {
            updatePlayPauseIcons(true);
            showControls();
        });

        // Update UI when paused
        mainVideo.addEventListener('pause', () => {
            updatePlayPauseIcons(false);
            clearTimeout(hideControlsTimeout);
            bottomControls.style.opacity = '1';
            centerPlayButton.style.opacity = '1';
            skipBackwardBtn.style.opacity = '1';
            skipForwardBtn.style.opacity = '1';
            videoInfo.style.opacity = '1';
            settingsContainer.style.opacity = '1';
        });

        // Update progress bar and time
        mainVideo.addEventListener('timeupdate', () => {
            const percent = (mainVideo.currentTime / mainVideo.duration) * 100;
            progressBar.style.width = percent + '%';
            progressHandle.style.left = percent + '%';
            currentTimeEl.textContent = formatTime(mainVideo.currentTime);
        });

        // Update duration when metadata loads
        mainVideo.addEventListener('loadedmetadata', () => {
            durationEl.textContent = formatTime(mainVideo.duration);
        });

        // Show loading spinner when video is buffering
        mainVideo.addEventListener('waiting', () => {
            loadingSpinner.classList.remove('hidden');
        });

        // Hide loading spinner when video can play
        mainVideo.addEventListener('canplay', () => {
            loadingSpinner.classList.add('hidden');
        });

        // Also hide loading spinner when video is playing
        mainVideo.addEventListener('playing', () => {
            loadingSpinner.classList.add('hidden');
        });

        // Show loading when seeking (stalled)
        mainVideo.addEventListener('seeking', () => {
            loadingSpinner.classList.remove('hidden');
        });

        // Hide loading when seek is complete
        mainVideo.addEventListener('seeked', () => {
            loadingSpinner.classList.add('hidden');
        });

        // Progress bar click to seek
        progressBarContainer.addEventListener('click', (e) => {
            const rect = progressBarContainer.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            mainVideo.currentTime = percent * mainVideo.duration;
        });

        // Volume control
        volumeBtn.addEventListener('click', () => {
            if (mainVideo.volume > 0) {
                mainVideo.volume = 0;
                volumeSlider.value = 0;
                volumeIcon.classList.add('hidden');
                muteIcon.classList.remove('hidden');
            } else {
                mainVideo.volume = 1;
                volumeSlider.value = 100;
                volumeIcon.classList.remove('hidden');
                muteIcon.classList.add('hidden');
            }
        });

        volumeSlider.addEventListener('input', (e) => {
            const volume = e.target.value / 100;
            mainVideo.volume = volume;

            if (volume === 0) {
                volumeIcon.classList.add('hidden');
                muteIcon.classList.remove('hidden');
            } else {
                volumeIcon.classList.remove('hidden');
                muteIcon.classList.add('hidden');
            }
        });

        // Fullscreen control
        fullscreenBtn.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                mainVideo.parentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        });

        // Update fullscreen icon
        document.addEventListener('fullscreenchange', () => {
            if (document.fullscreenElement) {
                fullscreenIcon.classList.add('hidden');
                exitFullscreenIcon.classList.remove('hidden');
            } else {
                fullscreenIcon.classList.remove('hidden');
                exitFullscreenIcon.classList.add('hidden');
            }
        });

        // Mouse movement on video container
        const videoContainer = mainVideo.parentElement;
        videoContainer.addEventListener('mousemove', () => {
            if (!mainVideoControls.classList.contains('hidden')) {
                showControls();
            }
        });

        videoContainer.addEventListener('mouseenter', () => {
            if (!mainVideoControls.classList.contains('hidden')) {
                showControls();
            }
        });

        videoContainer.addEventListener('mouseleave', () => {
            if (!mainVideo.paused && !mainVideoControls.classList.contains('hidden') && !isSettingsOpen) {
                bottomControls.style.opacity = '0';
                centerPlayButton.style.opacity = '0';
                skipBackwardBtn.style.opacity = '0';
                skipForwardBtn.style.opacity = '0';
                videoInfo.style.opacity = '0';
                settingsContainer.style.opacity = '0';
            }
        });

        // Track user interaction
        bottomControls.addEventListener('mouseenter', () => {
            isUserInteracting = true;
            clearTimeout(hideControlsTimeout);
        });

        bottomControls.addEventListener('mouseleave', () => {
            isUserInteracting = false;
            showControls();
        });

        // ============ SETTINGS MENU CONTROLS ============

        // Toggle settings menu
        settingsBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            isSettingsOpen = !isSettingsOpen;
            settingsMenu.classList.toggle('hidden');

            if (isSettingsOpen) {
                // Close submenus when opening settings
                speedSubmenu.classList.add('hidden');
                qualitySubmenu.classList.add('hidden');
            }
        });

        // Toggle speed submenu
        speedMenuBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            speedSubmenu.classList.toggle('hidden');
            qualitySubmenu.classList.add('hidden');
        });

        // Toggle quality submenu
        qualityMenuBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            qualitySubmenu.classList.toggle('hidden');
            speedSubmenu.classList.add('hidden');
        });

        // Speed option click handlers
        speedOptions.forEach(option => {
            option.addEventListener('click', (e) => {
                e.stopPropagation();
                const speed = parseFloat(option.dataset.speed);
                mainVideo.playbackRate = speed;

                // Update current speed display
                currentSpeed.textContent = speed === 1 ? '1x' : speed + 'x';

                // Update selected state
                speedOptions.forEach(opt => opt.classList.remove('bg-white/20'));
                option.classList.add('bg-white/20');

                // Close menus
                speedSubmenu.classList.add('hidden');
                settingsMenu.classList.add('hidden');
                isSettingsOpen = false;
            });
        });

        // Quality option click handlers
        qualityOptions.forEach(option => {
            option.addEventListener('click', (e) => {
                e.stopPropagation();
                const quality = option.dataset.quality;

                // Update current quality display
                currentQuality.textContent = quality.charAt(0).toUpperCase() + quality.slice(1);

                // Update selected state
                qualityOptions.forEach(opt => opt.classList.remove('bg-white/20'));
                option.classList.add('bg-white/20');

                // Close menus
                qualitySubmenu.classList.add('hidden');
                settingsMenu.classList.add('hidden');
                isSettingsOpen = false;

                // Note: Actual quality switching would require different video sources
                console.log('Quality changed to:', quality);
            });
        });

        // Close settings menu when clicking outside
        document.addEventListener('click', (e) => {
            if (isSettingsOpen && !settingsContainer.contains(e.target)) {
                settingsMenu.classList.add('hidden');
                speedSubmenu.classList.add('hidden');
                qualitySubmenu.classList.add('hidden');
                isSettingsOpen = false;
            }
        });

        // Track settings menu interaction
        settingsContainer.addEventListener('mouseenter', () => {
            isUserInteracting = true;
            clearTimeout(hideControlsTimeout);
        });

        settingsContainer.addEventListener('mouseleave', () => {
            if (!isSettingsOpen) {
                isUserInteracting = false;
                showControls();
            }
        });

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            if (mainVideoControls.classList.contains('hidden')) return;

            switch(e.key) {
                case ' ':
                case 'k':
                    e.preventDefault();
                    togglePlayPause();
                    break;
                case 'ArrowLeft':
                    e.preventDefault();
                    mainVideo.currentTime = Math.max(0, mainVideo.currentTime - 10);
                    showControls();
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    mainVideo.currentTime = Math.min(mainVideo.duration, mainVideo.currentTime + 10);
                    showControls();
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    mainVideo.volume = Math.min(1, mainVideo.volume + 0.1);
                    volumeSlider.value = mainVideo.volume * 100;
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    mainVideo.volume = Math.max(0, mainVideo.volume - 0.1);
                    volumeSlider.value = mainVideo.volume * 100;
                    break;
                case 'f':
                    e.preventDefault();
                    fullscreenBtn.click();
                    break;
                case 'm':
                    e.preventDefault();
                    volumeBtn.click();
                    break;
            }
        });

        // Prevent right-click context menu on videos
        adVideo.addEventListener('contextmenu', (e) => e.preventDefault());
        mainVideo.addEventListener('contextmenu', (e) => e.preventDefault());
    </script>
</body>
</html>
